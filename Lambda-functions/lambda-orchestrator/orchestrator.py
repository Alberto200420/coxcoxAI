from prompt_templates import DECISION_AGENT_TEMPLATE, ANSWERING_Q_AGENT_TEMPLATE, EXAMPLES_G_AGENT_TEMPLATE, CALL_TO_ACTION_AGENT_TEMPLATE
from langchain_core.messages import SystemMessage, HumanMessage, AIMessage
from langgraph.graph import StateGraph, START, END, MessagesState
from langchain_core.prompts import SystemMessagePromptTemplate
from langchain_aws import ChatBedrockConverse
from s3_checkpointer import S3Saver
from dotenv import load_dotenv
load_dotenv()
import os

llm_decision = ChatBedrockConverse(model="amazon.nova-micro-v1:0", temperature=0, top_p=0, max_tokens=20)
llm_answering_questions = ChatBedrockConverse(model="amazon.nova-lite-v1:0", temperature=0.7, top_p=0.9, max_tokens=512)
llm_example_generator = ChatBedrockConverse(model="amazon.nova-micro-v1:0", temperature=0.7, top_p=0.9, max_tokens=512)
llm_call_to_action = ChatBedrockConverse(model="amazon.nova-micro-v1:0", temperature=0.7, top_p=0.9, max_tokens=512)

class AgentState(MessagesState):
  """State for the multi-stage agent workflow"""
  decision: str

def decision_agent(state: AgentState):
  # Function to format the messages
  def format_messages(messages):
    formatted = "Analyze the following chat memory to find its appropriate category:\n"
    for message in messages:
      if isinstance(message, HumanMessage):
        formatted += f"USER:\n{message.content}\n"
      elif isinstance(message, AIMessage):
        formatted += f"AI Message:\n{message.content}\n"
    return formatted

  if len(state["messages"]) > 2:
    formatted_context = format_messages(state["messages"])
    system_prompt_template = SystemMessagePromptTemplate.from_template(DECISION_AGENT_TEMPLATE)
    system_message = system_prompt_template.format(context=formatted_context)
    print(f"Formatted system_message:\n{formatted_context}\n")
    response = llm_decision.invoke([system_message] + state["messages"][-1:])
  else:
    response = llm_decision.invoke([SystemMessage(content=DECISION_AGENT_TEMPLATE)] + state["messages"])
  return {"decision": response.content}

def answering_questions(state: AgentState):
  return {"messages": llm_answering_questions.invoke([SystemMessage(content=ANSWERING_Q_AGENT_TEMPLATE)] + state["messages"])}

def example_generator(state: AgentState):
  return {"messages": llm_example_generator.invoke([SystemMessage(content=EXAMPLES_G_AGENT_TEMPLATE)] + state["messages"])}

def call_to_action(state: AgentState):
  # Maybe do something like save the values on the state
  return {"messages": llm_call_to_action.invoke([SystemMessage(content=CALL_TO_ACTION_AGENT_TEMPLATE)] + state["messages"])}

def malicious_query(state: AgentState):
  # Maybe do something like alert to a person
  pass

# Build the state graph
builder = StateGraph(AgentState)
builder.add_node("decision_agent", decision_agent)
builder.add_node("answering_questions", answering_questions)
builder.add_node("example_generator", example_generator)
builder.add_node("call_to_action", call_to_action)
builder.add_node("malicious_query", malicious_query)

# Add edges and conditional logic
builder.add_edge(START, "decision_agent")

def route_decision(state: AgentState):
  decision = state["decision"]
  if "Use Case 1" in decision:
    return "answering_questions"
  elif "Use Case 2" in decision:
    return "example_generator"
  elif "Use Case 3" in decision:
    return "call_to_action"
  elif "Malicious Query" in decision:
    return "malicious_query"
  else:
    print(f"Unrecognized decision: {decision}")  # Debugging line
    return END  # Default case to avoid returning None

builder.add_conditional_edges("decision_agent", route_decision, 
                              ["answering_questions", "example_generator", "call_to_action", "malicious_query"])

builder.add_edge("answering_questions", END)
builder.add_edge("example_generator", END)
builder.add_edge("call_to_action", END)
builder.add_edge("malicious_query", END)

# Compile the graph with memory
# Dynamic_inputs
thread = input("Tread ID: ")
message = input("Mensaje para la IA: ")
# Start conversation
with S3Saver.from_bucket(bucket_name=os.getenv('AWS_S3_BUCKET_NAME'), region_name=os.getenv('AWS_DEFAULT_REGION')) as checkpointer:
  graph = builder.compile(checkpointer=checkpointer)
  res = graph.invoke({"messages": [HumanMessage(content=message)]}, {"configurable": {"thread_id": thread}})
  checkpoint_tuples = list(checkpointer.list(thread))
  print(f"checkpoint_tuples: {checkpoint_tuples}\n")
  for m in res['messages'][-1:]:
    m.pretty_print()

# Bedrock res:
# content='<category>\n"Use Case 2"\n</category>' additional_kwargs={} response_metadata={'ResponseMetadata': {'RequestId': 'b1c29feb-72a9-45c0-aa02-b2ccfc229253', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Tue, 14 Jan 2025 04:59:14 GMT', 'content-type': 'application/json', 'content-length': '222', 'connection': 'keep-alive', 'x-amzn-requestid': 'b1c29feb-72a9-45c0-aa02-b2ccfc229253'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [215]}} id='run-2f720b81-2cb4-4f5a-8679-951c2c0f5f4c-0' usage_metadata={'input_tokens': 567, 'output_tokens': 12, 'total_tokens': 579}

# LangGraph state:
# {'messages': [HumanMessage(content='Hola buena tarde, Mi empresa vende vinos y tomo mensajes por whatssapp, puedo implementar su IA?', additional_kwargs={}, response_metadata={}, id='3b3623f5-227e-4db1-90aa-344ea1b2e60c'), AIMessage(content='¡Hola! Buenas tardes. Sí, su empresa puede implementar el agente de inteligencia artificial de coxcox.ai, dado que actualmente solo trabaja con mensajes de WhatsApp y también vende productos.\n\n- **Para implementar el agente:**\n  - Envíe un correo electrónico a "albertog1meza@gmail.com" manifestando su interés en el agente de coxcox.ai.\n  - Adjunte el nombre de su empresa, su ubicación y el tiempo disponible para que una persona vaya e instale el agente en su empresa.\n\nEspero que esto le haya ayudado. ¡Que tenga un excelente día!', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': '79a3c737-55e0-49ca-b05a-e4c63e7a7761', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Wed, 15 Jan 2025 04:43:07 GMT', 'content-type': 'application/json', 'content-length': '737', 'connection': 'keep-alive', 'x-amzn-requestid': '79a3c737-55e0-49ca-b05a-e4c63e7a7761'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [1367]}}, id='run-86075042-f84b-45f9-a8e8-12c4c86a7927-0', usage_metadata={'input_tokens': 896, 'output_tokens': 129, 'total_tokens': 1025})], 'decision': 'Use Case 1', 'company_name': '', 'location': '', 'installation_time': '', 'contact': ''}

# Checkpoint tuples:
# [CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-8fbd-6151-8002-57cf11348abf'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:16:36.130577+00:00', 'id': '1efd5291-8fbd-6151-8002-57cf11348abf', 'channel_values': {'messages': [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={}, id='57dd6251-710d-46a3-bf14-986d4d15ed0b'), AIMessage(content='La instalación del agente coxcox.ai en tu empresa tiene un tiempo estimado de una semana o menos. Aquí te dejo los pasos que debes seguir para comenzar con el proceso de instalación:\n\n- **Enviar interés**: \n   - Redacta un correo electrónico a "albertog1meza@gmail.com".\n   - Muestra tu interés en el agente coxcox.ai.\n   - Adjunta información relevante como el nombre de tu empresa, su ubicación y el tiempo disponible para la instalación.\n\n- **Esperando respuesta**:\n   - Una vez enviado el correo, espera la respuesta del equipo de coxcox.ai.\n   - Ellos te proporcionarán más detalles y te asistirán en el proceso de instalación.\n\n- **Instalación**:\n   - El equipo de coxcox.ai se encargará de la instalación en tu empresa.\n   - El tiempo estimado para la instalación es de una semana o menos.\n\n¡Espero que esto te haya ayudado! Si tienes alguna otra pregunta, no dudes en preguntar.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:16:37 GMT', 'content-type': 'application/json', 'content-length': '1107', 'connection': 'keep-alive', 'x-amzn-requestid': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [2293]}}, id='run-d921b75d-3ba5-4481-99c0-84d237db180a-0', usage_metadata={'input_tokens': 885, 'output_tokens': 215, 'total_tokens': 1100})], 'decision': 'Use Case 1', 'answering_questions': 'answering_questions'}, 'channel_versions': {'__start__': 2, 'messages': 4, 'start:decision_agent': 3, 'decision': 3, 'decision_agent': 4, 'branch:decision_agent:route_decision:answering_questions': 4, 'answering_questions': 4}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}, 'decision_agent': {'start:decision_agent': 2}, 'answering_questions': {'branch:decision_agent:route_decision:answering_questions': 3}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': {'answering_questions': {'messages': AIMessage(content='La instalación del agente coxcox.ai en tu empresa tiene un tiempo estimado de una semana o menos. Aquí te dejo los pasos que debes seguir para comenzar con el proceso de instalación:\n\n- **Enviar interés**: \n   - Redacta un correo electrónico a "albertog1meza@gmail.com".\n   - Muestra tu interés en el agente coxcox.ai.\n   - Adjunta información relevante como el nombre de tu empresa, su ubicación y el tiempo disponible para la instalación.\n\n- **Esperando respuesta**:\n   - Una vez enviado el correo, espera la respuesta del equipo de coxcox.ai.\n   - Ellos te proporcionarán más detalles y te asistirán en el proceso de instalación.\n\n- **Instalación**:\n   - El equipo de coxcox.ai se encargará de la instalación en tu empresa.\n   - El tiempo estimado para la instalación es de una semana o menos.\n\n¡Espero que esto te haya ayudado! Si tienes alguna otra pregunta, no dudes en preguntar.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:16:37 GMT', 'content-type': 'application/json', 'content-length': '1107', 'connection': 'keep-alive', 'x-amzn-requestid': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [2293]}}, id='run-d921b75d-3ba5-4481-99c0-84d237db180a-0', usage_metadata={'input_tokens': 885, 'output_tokens': 215, 'total_tokens': 1100})}}, 'thread_id': '+524428968441', 'step': 2, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-7309-6185-8001-36f1ed8287cf'}}, pending_writes=[]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-7309-6185-8001-36f1ed8287cf'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:16:33.120845+00:00', 'id': '1efd5291-7309-6185-8001-36f1ed8287cf', 'channel_values': {'messages': [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={}, id='57dd6251-710d-46a3-bf14-986d4d15ed0b')], 'decision': 'Use Case 1', 'decision_agent': 'decision_agent', 'branch:decision_agent:route_decision:answering_questions': 'decision_agent'}, 'channel_versions': {'__start__': 2, 'messages': 2, 'start:decision_agent': 3, 'decision': 3, 'decision_agent': 3, 'branch:decision_agent:route_decision:answering_questions': 3}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}, 'decision_agent': {'start:decision_agent': 2}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': {'decision_agent': {'decision': 'Use Case 1'}}, 'thread_id': '+524428968441', 'step': 1, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-6adb-6170-8000-87aca8e0bbeb'}}, pending_writes=[('b66cf2ee-2373-adbc-abe0-f8b6fc0fa205', 'messages', AIMessage(content='La instalación del agente coxcox.ai en tu empresa tiene un tiempo estimado de una semana o menos. Aquí te dejo los pasos que debes seguir para comenzar con el proceso de instalación:\n\n- **Enviar interés**: \n   - Redacta un correo electrónico a "albertog1meza@gmail.com".\n   - Muestra tu interés en el agente coxcox.ai.\n   - Adjunta información relevante como el nombre de tu empresa, su ubicación y el tiempo disponible para la instalación.\n\n- **Esperando respuesta**:\n   - Una vez enviado el correo, espera la respuesta del equipo de coxcox.ai.\n   - Ellos te proporcionarán más detalles y te asistirán en el proceso de instalación.\n\n- **Instalación**:\n   - El equipo de coxcox.ai se encargará de la instalación en tu empresa.\n   - El tiempo estimado para la instalación es de una semana o menos.\n\n¡Espero que esto te haya ayudado! Si tienes alguna otra pregunta, no dudes en preguntar.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:16:37 GMT', 'content-type': 'application/json', 'content-length': '1107', 'connection': 'keep-alive', 'x-amzn-requestid': '4c9d61d6-5ac8-4263-ae3e-ba1b6fbdd7ca'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [2293]}}, id='run-d921b75d-3ba5-4481-99c0-84d237db180a-0', usage_metadata={'input_tokens': 885, 'output_tokens': 215, 'total_tokens': 1100})), ('b66cf2ee-2373-adbc-abe0-f8b6fc0fa205', 'answering_questions', 'answering_questions')]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-6adb-6170-8000-87aca8e0bbeb'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:16:32.263129+00:00', 'id': '1efd5291-6adb-6170-8000-87aca8e0bbeb', 'channel_values': {'messages': [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={}, id='57dd6251-710d-46a3-bf14-986d4d15ed0b')], 'start:decision_agent': '__start__'}, 'channel_versions': {'__start__': 2, 'messages': 2, 'start:decision_agent': 2}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': None, 'thread_id': '+524428968441', 'step': 0, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-6aab-6ae0-bfff-2c48aa0a574e'}}, pending_writes=[('a7654be7-d044-6588-e148-9132b7476f93', 'decision', 'Use Case 1'), ('a7654be7-d044-6588-e148-9132b7476f93', 'decision_agent', 'decision_agent'), ('a7654be7-d044-6588-e148-9132b7476f93', 'branch:decision_agent:route_decision:answering_questions', 'decision_agent')]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5291-6aab-6ae0-bfff-2c48aa0a574e'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:16:32.243754+00:00', 'id': '1efd5291-6aab-6ae0-bfff-2c48aa0a574e', 'channel_values': {'__start__': {'messages': [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={})]}}, 'channel_versions': {'__start__': 1}, 'versions_seen': {'__input__': {}}, 'pending_sends': []}, metadata={'source': 'input', 'writes': {'__start__': {'messages': [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={})]}}, 'thread_id': '+524428968441', 'step': -1, 'parents': {}}, parent_config=None, pending_writes=[('cf35bb6f-028d-df62-9ffb-2fa61c2349c1', 'messages', [HumanMessage(content='Interesante, y cuanto se tarda en instalarmelo?', additional_kwargs={}, response_metadata={})]), ('cf35bb6f-028d-df62-9ffb-2fa61c2349c1', 'start:decision_agent', '__start__')]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-da04-6049-8002-7234af8b7be2'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:13:09.170735+00:00', 'id': '1efd5289-da04-6049-8002-7234af8b7be2', 'channel_values': {'messages': [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={}, id='c07443d0-7b93-42f2-b93f-69bdbcc53cae'), AIMessage(content='Buenas tardes, me alegra mucho que te haya llamado la atención nuestra IA. El costo de implementar nuestro agente en tu negocio depende de varios factores, como la cantidad de mensajes que recibas y respondas por WhatsApp, la complejidad de tus productos y precios, y la frecuencia con la que necesites hacer llamadas a la base de datos.\n\n- **Para obtener una cotización precisa**, te recomendamos que envíes un correo electrónico a la dirección **"albertog1meza@gmail.com"** con los siguientes datos:\n  - Nombre de tu empresa\n  - Ubicación de tu empresa\n  - Horario disponible para la instalación del agente\n\nDe esta manera, nuestro equipo de ventas podrá proporcionarte una oferta detallada y personalizada según tus necesidades. \n\nEspero haberte ayudado y quedo a tu disposición para cualquier otra pregunta que puedas tener.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:13:10 GMT', 'content-type': 'application/json', 'content-length': '1035', 'connection': 'keep-alive', 'x-amzn-requestid': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [1926]}}, id='run-73522be3-09d6-4cee-bdcb-f73925afe957-0', usage_metadata={'input_tokens': 901, 'output_tokens': 175, 'total_tokens': 1076})], 'decision': 'Use Case 1', 'answering_questions': 'answering_questions'}, 'channel_versions': {'__start__': 2, 'messages': 4, 'start:decision_agent': 3, 'decision': 3, 'decision_agent': 4, 'branch:decision_agent:route_decision:answering_questions': 4, 'answering_questions': 4}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}, 'decision_agent': {'start:decision_agent': 2}, 'answering_questions': {'branch:decision_agent:route_decision:answering_questions': 3}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': {'answering_questions': {'messages': AIMessage(content='Buenas tardes, me alegra mucho que te haya llamado la atención nuestra IA. El costo de implementar nuestro agente en tu negocio depende de varios factores, como la cantidad de mensajes que recibas y respondas por WhatsApp, la complejidad de tus productos y precios, y la frecuencia con la que necesites hacer llamadas a la base de datos.\n\n- **Para obtener una cotización precisa**, te recomendamos que envíes un correo electrónico a la dirección **"albertog1meza@gmail.com"** con los siguientes datos:\n  - Nombre de tu empresa\n  - Ubicación de tu empresa\n  - Horario disponible para la instalación del agente\n\nDe esta manera, nuestro equipo de ventas podrá proporcionarte una oferta detallada y personalizada según tus necesidades. \n\nEspero haberte ayudado y quedo a tu disposición para cualquier otra pregunta que puedas tener.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:13:10 GMT', 'content-type': 'application/json', 'content-length': '1035', 'connection': 'keep-alive', 'x-amzn-requestid': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [1926]}}, id='run-73522be3-09d6-4cee-bdcb-f73925afe957-0', usage_metadata={'input_tokens': 901, 'output_tokens': 175, 'total_tokens': 1076})}}, 'thread_id': '+524428968441', 'step': 2, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-c19a-620d-8001-8583d010590f'}}, pending_writes=[]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-c19a-620d-8001-8583d010590f'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:13:06.610769+00:00', 'id': '1efd5289-c19a-620d-8001-8583d010590f', 'channel_values': {'messages': [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={}, id='c07443d0-7b93-42f2-b93f-69bdbcc53cae')], 'decision': 'Use Case 1', 'decision_agent': 'decision_agent', 'branch:decision_agent:route_decision:answering_questions': 'decision_agent'}, 'channel_versions': {'__start__': 2, 'messages': 2, 'start:decision_agent': 3, 'decision': 3, 'decision_agent': 3, 'branch:decision_agent:route_decision:answering_questions': 3}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}, 'decision_agent': {'start:decision_agent': 2}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': {'decision_agent': {'decision': 'Use Case 1'}}, 'thread_id': '+524428968441', 'step': 1, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-ba21-69a4-8000-14fd8c9bd432'}}, pending_writes=[('63f361e7-bf93-1d4a-e2a6-7b1208029713', 'messages', AIMessage(content='Buenas tardes, me alegra mucho que te haya llamado la atención nuestra IA. El costo de implementar nuestro agente en tu negocio depende de varios factores, como la cantidad de mensajes que recibas y respondas por WhatsApp, la complejidad de tus productos y precios, y la frecuencia con la que necesites hacer llamadas a la base de datos.\n\n- **Para obtener una cotización precisa**, te recomendamos que envíes un correo electrónico a la dirección **"albertog1meza@gmail.com"** con los siguientes datos:\n  - Nombre de tu empresa\n  - Ubicación de tu empresa\n  - Horario disponible para la instalación del agente\n\nDe esta manera, nuestro equipo de ventas podrá proporcionarte una oferta detallada y personalizada según tus necesidades. \n\nEspero haberte ayudado y quedo a tu disposición para cualquier otra pregunta que puedas tener.', additional_kwargs={}, response_metadata={'ResponseMetadata': {'RequestId': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75', 'HTTPStatusCode': 200, 'HTTPHeaders': {'date': 'Fri, 17 Jan 2025 23:13:10 GMT', 'content-type': 'application/json', 'content-length': '1035', 'connection': 'keep-alive', 'x-amzn-requestid': 'b98c1f99-b6fd-4b0a-bdad-1f9dc1cbed75'}, 'RetryAttempts': 0}, 'stopReason': 'end_turn', 'metrics': {'latencyMs': [1926]}}, id='run-73522be3-09d6-4cee-bdcb-f73925afe957-0', usage_metadata={'input_tokens': 901, 'output_tokens': 175, 'total_tokens': 1076})), ('63f361e7-bf93-1d4a-e2a6-7b1208029713', 'answering_questions', 'answering_questions')]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-ba21-69a4-8000-14fd8c9bd432'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:13:05.827409+00:00', 'id': '1efd5289-ba21-69a4-8000-14fd8c9bd432', 'channel_values': {'messages': [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={}, id='c07443d0-7b93-42f2-b93f-69bdbcc53cae')], 'start:decision_agent': '__start__'}, 'channel_versions': {'__start__': 2, 'messages': 2, 'start:decision_agent': 2}, 'versions_seen': {'__input__': {}, '__start__': {'__start__': 1}}, 'pending_sends': []}, metadata={'source': 'loop', 'writes': None, 'thread_id': '+524428968441', 'step': 0, 'parents': {}}, parent_config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-b9fa-69be-bfff-0b6fb47ab973'}}, pending_writes=[('69a9a6ba-b18d-0853-6d2a-4acc935d3d56', 'decision', 'Use Case 1'), ('69a9a6ba-b18d-0853-6d2a-4acc935d3d56', 'decision_agent', 'decision_agent'), ('69a9a6ba-b18d-0853-6d2a-4acc935d3d56', 'branch:decision_agent:route_decision:answering_questions', 'decision_agent')]), CheckpointTuple(config={'configurable': {'thread_id': '524428968441', 'checkpoint_ns': '', 'checkpoint_id': '1efd5289-b9fa-69be-bfff-0b6fb47ab973'}}, checkpoint={'v': 1, 'ts': '2025-01-17T23:13:05.811472+00:00', 'id': '1efd5289-b9fa-69be-bfff-0b6fb47ab973', 'channel_values': {'__start__': {'messages': [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={})]}}, 'channel_versions': {'__start__': 1}, 'versions_seen': {'__input__': {}}, 'pending_sends': []}, metadata={'source': 'input', 'writes': {'__start__': {'messages': [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={})]}}, 'thread_id': '+524428968441', 'step': -1, 'parents': {}}, parent_config=None, pending_writes=[('eb16ddfe-b099-bf8e-80cc-c41fc8d4c931', 'messages', [HumanMessage(content='Hola buena tarde, vi su video y me llamo mucho la atencion su IA, cuanto cuesta por implementarlo en mi negocio?', additional_kwargs={}, response_metadata={})]), ('eb16ddfe-b099-bf8e-80cc-c41fc8d4c931', 'start:decision_agent', '__start__')])]